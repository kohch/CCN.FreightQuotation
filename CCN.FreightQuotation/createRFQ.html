<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
        <link type="text/css" rel="stylesheet" href="styles/jquery.mmenu.css" />
        <link type="text/css" rel="stylesheet" href="styles/main.css" />

        <!-- uncoment viewport meta tag, if targeting Android 4.x.x devices -->
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
        <script src="cordova.js" type="text/javascript"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

        <script>
            $(function() { 
                $.mobile.defaultHomeScroll = 0;
            });
        </script>
        <script src="scripts/rfqdata.js" type="text/javascript"></script>
        <script src="scripts/main.js" type="text/javascript"></script>
        <script src="scripts/rfqservice.js" type="text/javascript"></script>

        <script type="text/javascript" src="scripts/jquery.mmenu.js"></script>
        <script type="text/javascript">

            $(function() {
                $('#menu').mmenu({
                    onClick		: {
                        blockUI			: false,
                        preventDefault	: function() {
                            return this.rel != 'external';
                        }
                    }
                }, {
                    pageSelector: 'div[data-role="page"]:first'
                });

                $('#menu a[rel!="external"]').on(
                    'click',
                    function() {
                        var _t = this;
                        $('#menu').one(
                            'closed.mm',
                            function() {
                                $.mobile.changePage(_t.href, {
                                    transition: 'fade'
                                });
                            }
                            );
                    }
                    );
            });
            
            $(document).on(
                'pageshow',
                function(e, ui) {
                    $('#menu').trigger('setPage', [ $(e.target) ]);
                    $('#menu a').each(
                        function() {
                            if ($.mobile.path.parseUrl(this.href).href == window.location.href) {
                                $(this).trigger('setSelected.mm');
                            }
                        }
                        );
                }
                ); 
            
            $(document).ready(function() {
                getContactsData();
                $("#btnSave").click(function() {                    
                    var str = "";
                    $("select option:selected").each(function() {
                        str += $(this).text() + "<br>";
                    });
                    $("#selectedrecipients").append("<p>" + str + "</p>");
                    
                    //Call webservice to save the RFQ.
                    saveRFQData();
                }),
                $("#btnSubmit").click(function() {                    
                    //Call webservice to save the RFQ.
                    submitRFQData();
                });
            });                 
            
            
            function getContactsData() {               
                Type = "GET";
                Url = "http://172.16.202.171/ContactService/ContactService.svc/GetContacts";
                ContentType = "application/json; charset=utf-8";
                DataType = "json";
                Method = "GetContacts";
                ProcessData = false;               
                callService();
            }     
            
            function saveRFQData() { 
                var recipients = "";
                $("select option:selected").each(function() {
                    recipients += $(this).text() + ",";
                });            
                
                
                var request = new Object();               
                request.ValidFrom = $("#validfrom").val();
                request.ExpireOn = $("#expireon").val();
                request.Origin = $("#origin").val();
                request.Destination = $("#destination").val();
                request.Pieces = $("#pieces").val();
                request.Weight = $("#weight").val();
                request.Volume = $("#volume").val();
                request.Dimension = $("#dimension").val();
                request.GoodsDescription = $("#goodsdescription").val();
                request.Commodity = $("#commodity").val();
                request.ContactName = $("#contactname").val();
                request.LodgeInDT = $("#lodgeindate").val();
                request.CollectionDT = $("#collectiondate").val();
                request.Recipients = recipients;
                request.Status = "Save";               
                request.RequesterID = "jaxon.daniels@gmail.com";
                //var datastr = {"CollectionDT":"1\/1\/2014 11:12:13 AM","Commodity":"RFQ","ContactName":null,"CreatedDT":"1\/1\/2014 11:12:13 AM","Destination":"SYN","Dimension":null,"ExpireOn":"1\/1\/2014 11:12:13 AM","GoodsDescription":"TESTING MY GOODS Description","LodgeInDT":"1\/1\/2014 11:12:13 AM","Origin":"KUL","Pieces":200,"Recipients":null,"RequestID":null,"RequesterID":"8dec1a71-f386-400c-8a65-87ed760ced03","Status":"Pending","SubmittedDT":null,"ValidFrom":null,"Volume":1234,"Weight":2030};
                Type = "POST";
                //Url = "http://172.16.202.171/RFQService/RFQService.svc/SaveRFQ";
                Url = "http://localhost:20485/RFQService.svc/SaveRFQ";
                ContentType = "application/json";
                DataType = "json";
                Method = "SaveRFQ";
                ProcessData = true;  
                Data = JSON.stringify({ newRequest: request });
                callService();               
            }
            
            function submitRFQData() {                    
                var datastr = [{"newRequest":{"CollectionDT":"1\/1\/2014 11:12:13 AM","Commodity":"RFQ","ContactName":null,"CreatedDT":"1\/1\/2014 11:12:13 AM","Destination":"SYN","Dimension":null,"ExpireOn":"1\/1\/2014 11:12:13 AM","GoodsDescription":"TESTING MY GOODS Description","LodgeInDT":"1\/1\/2014 11:12:13 AM","Origin":"KUL","Pieces":200,"Recipients":null,"RequestID":null,"RequesterID":"8dec1a71-f386-400c-8a65-87ed760ced03","Status":"Pending","SubmittedDT":null,"ValidFrom":null,"Volume":1234,"Weight":2030}}];
                Type = "POST";
                Url = "http://172.16.202.171/RFQService/RFQService.svc/SubmitRFQ";
                ContentType = "application/json";
                DataType = "json";
                Method = "SubmitRFQ";
                ProcessData = true;  
                Data = JSON.stringify(datastr);
                callService();               
            }
            
            function serviceSucceeded(result) {
                if (Method == "GetContacts") {
                    $.each(result, function(i, contact) {   
                        $("#recipients").append("<option value='" + contact.AccountID + "'>" + contact.Email + "</option>");                      
                    });
                }
                else if (Method == "SaveRFQ") {
                    alert(result);
                }
                else if (Method == "SubmitRFQ") {
                    alert("submit success.");
                }
            }
        </script>
    </head>
    <body>
        <div id="createpage1" data-role="page">
            <div data-role="header" data-tap-toggle="false">
                <a id="menubtn" href="#menu"></a>
                <h1>New RFQ</h1>
            </div>
            <div data-role="content">
                <input type="text" id="origin" value="Origin" />
                <input type="text" id="destination" value="Destination" />
                <input type="text" id="peices" value="Pieces" />
                <input type="text" id="weight" value="Weight" />
                <input type="text" id="volume" value="1234" />
                <input type="text" id="dimension" value="Dimension" />
                <label for="lodgeindate">Lodge In Date:</label>
                <input type="date" name="lodgeindate" id="lodgeindate">
                <label for="collectiondate">Collection Date:</label>
                <input type="date" name="collectiondate" id="collectiondate">
                <a href="createRFQ.html#createpage2" data-role="button">Next</a>
            </div>
        </div>
        <div id="createpage2" data-role="page">
            <div data-role="header" data-tap-toggle="false">
                <a id="menubtn" href="#menu"></a>
                <h1>New RFQ</h1>
                <a href="createRFQ.html#createpage1" data-role="button">Back</a>
            </div>
            <div data-role="content">
                <input type="text" id="contactname" value="Contact Name" />
                <textarea name="goodsdescription" id="goodsdescription" value ="Goods Description"></textarea>
                <input type="text" id="commodity" value="Commodity" />
                <select id="recipients" name="recipients" multiple="multiple" data-native-menu="false">
                    <option>Choose recipients</option>
                </select>
                <label for="validfrom">Valid From:</label>
                <input type="date" name="validfrom" id="validfrom">
                <label for="exipreon">Expire On:</label>
                <input type="date" name="exipreon" id="expireon">
                <a id="btnSave" href="createRFQ.html#createpage3" data-role="button">Save</a>
            </div>
        </div>
        <div id="createpage3" data-role="page">
            <div data-role="header" data-tap-toggle="false">
                <a id="menubtn" href="#menu"></a>
                <h1>New RFQ</h1>
            </div>
            <div data-role="content">
                <p>
                    Your request for quotation is saved! <br><br>
                    
                    Click submit to send to the recipients now.
                </p>
                <div id="selectedrecipients"></div>
                <a id="btnSubmit" href="main.html#home" rel="external" data-role="button">Submit</a>
            </div>
        </div>
        <!-- main menu -->
        <nav id="menu">
            <ul>
                <li>
                    <a href="main.html#home" rel="external">Home</a>
                </li>
                <li  class="Selected">
                    <a href="createRFQ.html">Create RFQ</a>
                </li>
                <li>
                    <a href="main.html#search" rel="external">Search RFQ</a>
                </li>
                <li>
                    <a href="main.html#settings" rel="external">Settings</a>
                </li>
                <li>
                    <a href="">Log Out</a>
                </li>
            </ul>
        </nav>
    </body>
</html>
